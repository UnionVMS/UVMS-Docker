sudo: required

branches:
  only:
  - docker-release-travis

services:
  - docker

env:
  - TAG=uvms/wildfly:8.2.0 TAG_LATEST=uvms/wildfly:latest TAG_FOCUS=nexus.focus.fish:9081/uvms/wildfly:8.2.0 TAG_FOCUS_LATEST=nexus.focus.fish:9081/uvms/wildfly:latest IMAGE=wildfly-base
  - TAG=uvms/postgres:9.3 TAG_LATEST=uvms/postgres:latest TAG_FOCUS=nexus.focus.fish:9081/uvms/postgres:9.3 TAG_FOCUS_LATEST=nexus.focus.fish:9081/uvms/postgres:latest IMAGE=postgres-base
  - TAG=uvms/activemq:5.13.2 TAG_LATEST=uvms/activemq:latest TAG_FOCUS=nexus.focus.fish:9081/uvms/activemq:5.13.2 TAG_FOCUS_LATEST=nexus.focus.fish:9081/uvms/activemq:latest IMAGE=amq
  - TAG=uvms/wildfly-release:$TRAVIS_BUILD_NUMBER TAG_LATEST=uvms/wildfly-release:latest TAG_FOCUS=nexus.focus.fish:9081/uvms/wildfly-release:$TRAVIS_BUILD_NUMBER TAG_FOCUS_LATEST=nexus.focus.fish:9081/uvms/wildfly-release:latest IMAGE=wildfly-release
  - TAG=uvms/postgres-release:$TRAVIS_BUILD_NUMBER TAG_LATEST=uvms/postgres-release:latest TAG_FOCUS=nexus.focus.fish:9081/uvms/postgres-release:$TRAVIS_BUILD_NUMBER TAG_FOCUS_LATEST=nexus.focus.fish:9081/uvms/postgres-release:latest IMAGE=postgres-release

script:
  - docker build -t $TAG -t $TAG_LATEST -t $TAG_FOCUS -t $TAG_FOCUS_LATEST --no-cache $IMAGE

after_success:
  - docker login nexus.focus.fish:9081 -u="$FOCUS_USERNAME" -p="$FOCUS_PASSWORD"; 
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker push $TAG;
    docker push $TAG_LATEST;
    docker push $TAG_FOCUS;
    docker push $TAG_FOCUS_LATEST;
